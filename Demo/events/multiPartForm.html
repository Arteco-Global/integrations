<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="../style.css">
</head>

<body>
  <h1>Send event using multipart form</h1>
  <div class="container">
    <form id="artecoForm" action="/action_page.php">
      <label for="artecoServerIP">Server IP</label>
      <input type="text" id="artecoServerIP" name="arteco_server_ip"
        placeholder="https://mdalprato.lan.omniaweb.cloud:443" value="https://mdalprato.lan.omniaweb.cloud:443">
  
      <label for="artecoServerParam">JSON</label>
      <textarea id="artecoServerParam" name="arteco" placeholder="Write something ..."
        style="height:200px">{"lane": "manageEvent", "data": { "ctx": "liveEvent", "chId": 0,  "param": "Steve Jobs", "brand":"VCA", "data":"---data--",  "cat": 200  }}</textarea>
      <label for="artecoServerImage">Event image</label>
      <input type="file" name="arteco_server_image" id="artecoServerImage">
      <input type="submit" value="Submit">
    </form>
  </div>
</body>

</html>
<script>

  window.addEventListener("load", () => {
    function sendData() {

      const artecoServerIP = document.getElementById("artecoServerIP").value;

      const url = artecoServerIP + "/api/v2/event";

      const XHR = new XMLHttpRequest();

      // Bind the FormData object and the form element
      const FD = new FormData(form);

      // Define what happens on successful data submission
      XHR.addEventListener("load", (event) => {
        alert(event.target.responseText);
      });

      // Define what happens in case of error
      XHR.addEventListener("error", (event) => {
        alert('Oops! Something went wrong.');
      });

      // Set up our request
      XHR.open("POST", url);

      // The data sent is what the user provided in the form
      XHR.send(FD);
    }

    // Get the form element
    const form = document.getElementById("artecoForm");

    // Add 'submit' event handler
    form.addEventListener("submit", (event) => {
      event.preventDefault();

      sendData();
    });
  });
</script>